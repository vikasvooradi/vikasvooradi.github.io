<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Vikas Vooradi - SQL Problems</title>

<style>
/* --- SAME CSS AS YOUR FILE (UNCHANGED) --- */
body {
  font-family: system-ui, -apple-system, BlinkMacSystemFont;
  background: linear-gradient(135deg, #667eea, #764ba2);
  min-height: 100vh;
  padding: 20px;
}
.container { max-width: 1000px; margin: auto; }
.hidden { display: none; }
.loading, footer {
  background: white;
  border-radius: 12px;
  padding: 40px;
  text-align: center;
}
.problem-card {
  background: white;
  border-radius: 12px;
  margin-bottom: 15px;
  box-shadow: 0 5px 15px rgba(0,0,0,.1);
}
.problem-header {
  display: flex;
  gap: 15px;
  padding: 20px;
  cursor: pointer;
}
.problem-number {
  background: #667eea;
  color: white;
  padding: 6px 12px;
  border-radius: 6px;
}
.expand-icon { margin-left: auto; }
.problem-content { max-height: 0; overflow: hidden; transition: .4s; }
.problem-content.expanded { max-height: 3000px; }
.question-section { background: #f8f9fa; padding: 20px; }
.solution-section { background: #2d2d2d; color: white; max-height: 0; overflow: hidden; transition: .4s; }
.solution-section.expanded { max-height: 800px; }
.solution-btn { margin: 20px; padding: 10px 20px; cursor: pointer; }
</style>
</head>

<body>
<div class="container">

<header class="loading">
  <h1>üéØ Vikas Vooradi</h1>
  <p>LeetCode SQL Solutions</p>
  <a href="https://github.com/vikasvooradi/leetcode-oracle" target="_blank">
    View on GitHub
  </a>
</header>

<input id="searchBar" placeholder="Search problems..." />

<div id="loading" class="loading">
  Loading problems...
</div>

<div id="problemsList"></div>

<footer>
  Made with ‚ù§Ô∏è by Vikas Vooradi
</footer>

</div>

<script>
let allProblems = [];
let state = {};

function escapeHtml(t) {
  const d = document.createElement("div");
  d.textContent = t;
  return d.innerHTML;
}

function render() {
  const root = document.getElementById("problemsList");
  root.innerHTML = "";

  allProblems.forEach((p, i) => {
    const card = document.createElement("div");
    card.className = "problem-card";
    card.dataset.search = (p.number + " " + p.title).toLowerCase();

    card.innerHTML = `
      <div class="problem-header" onclick="toggle(${i})">
        <div class="problem-number">#${p.number}</div>
        <div>${escapeHtml(p.title)}</div>
        <div class="expand-icon">‚ñº</div>
      </div>
      <div class="problem-content" id="c-${i}">
        <div class="question-section" id="q-${i}">Loading question‚Ä¶</div>
        <button class="solution-btn" onclick="solution(${i}, event)">Show Solution</button>
        <pre class="solution-section" id="s-${i}">Loading solution‚Ä¶</pre>
      </div>
    `;
    root.appendChild(card);
  });
}

async function toggle(i) {
  const el = document.getElementById("c-" + i);
  el.classList.toggle("expanded");

  if (!state[i]?.q) {
    const r = await fetch(allProblems[i].readmeUrl);
    document.getElementById("q-" + i).innerHTML = await r.text();
    state[i] = { ...state[i], q: true };
  }
}

async function solution(i, e) {
  e.stopPropagation();
  const el = document.getElementById("s-" + i);
  el.classList.toggle("expanded");

  if (!state[i]?.s) {
    const r = await fetch(allProblems[i].sqlUrl);
    el.textContent = await r.text();
    state[i] = { ...state[i], s: true };
  }
}

document.getElementById("searchBar").addEventListener("input", e => {
  const q = e.target.value.toLowerCase();
  document.querySelectorAll(".problem-card").forEach(c => {
    c.style.display = c.dataset.search.includes(q) ? "block" : "none";
  });
});

async function init() {
  try {
    const res = await fetch("./problems.json", { cache: "no-store" });

    if (!res.ok) {
      throw new Error("problems.json NOT FOUND (404)");
    }

    const data = await res.json();
    allProblems = data.problems;
    document.getElementById("loading").classList.add("hidden");
    render();

    console.log("Loaded", allProblems.length, "problems");

  } catch (err) {
    console.error(err);
    document.getElementById("loading").innerHTML = `
      ‚ùå <b>problems.json missing</b><br/>
      Run <code>node build.js</code> and commit the file.
    `;
  }
}

init();
</script>
</body>
</html>
